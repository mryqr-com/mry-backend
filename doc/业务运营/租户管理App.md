# 租户管理

## 本地环境
- 以`15111111111`(密码：11111111)登录本地[码如云自运营页面](http://console.mryqrlocal.com/management/my-apps)
- 点击`租户管理`即可进入租户管理页面

## 原理

- 处理沟通记录数据之外，所有数据均通过系统的`Tenant`对象同步而来
- 每个租户实例的自定义编号被系统自动设置为`Tenant`的ID，用于关联租户实例和`Tenant`对象并完成数据同步
- 对`Tenant`的操作将发出领域事件，然后触发同步过程，由于`Tenant`中`应用用量`等数据的更新采用delta方式统计，此时不会发出领域事件，也即不会立即触发同步，每天5点半运行的存储统计将发出领域事件并触发`Tenant`
  数据同步
- 同步数据时，如果`Tenant`对应的租户实例不存在，那么系统将自动创建租户实例
- 如需看到某个`Tenant`的最新数据，你也可以手动同步后台数据
- 对租户实例的操作将通过提交Submission的方式进行，提交Submission后将触发webhook，webhook将调用`Tenant`中的方法完成对`Tenant`的操作，之后将发出领域事件进而将数据同步到租户实例

## 操作

- 设置套餐：为某个Tenant设置套餐及过期时间，比如有时需要额外给某个Tenant套餐优惠时
- 启禁用设置：设置某个Tenant的启用状态，比如有时需要禁用某个被举报的Tenant
- 清空子域名：强制清空某个Tenant的子域名，清空后租户可以另行设置

## 误删实例解决办法

- 有时可能出现误删租户实例的情况，此时可以手动新增租户实例即可，不过先前的沟通记录将丢失。

## 手动新增租户实例

- 新建实例，确保实例的自定义编号设置为租户编号
- 如果希望立即看到租户数据，可以手动同步后台数据